<div class="min-h-screen bg-gray-50 dark:bg-gray-900 p-4 transition-colors">
  <!-- HEADER -->
  <div class="bg-linear-to-r from-blue-600 to-indigo-600 text-white rounded-lg p-6 shadow-lg mb-6">
    <div class="flex items-center gap-3">
      <i class="pi pi-cog text-3xl"></i>
      <div>
        <h1 class="text-3xl font-bold">‚öôÔ∏è Configuraci√≥n de Peluquer√≠a</h1>
        <p class="text-sm opacity-90">Personaliza tu negocio con gobierno defensivo</p>
      </div>
    </div>
  </div>

  <!-- ADVERTENCIA DE GOBIERNO -->
  <div class="rounded-xl p-4 shadow-sm bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-800 mb-6">
    <div class="flex items-start gap-3">
      <i class="pi pi-shield text-yellow-600 dark:text-yellow-400 text-xl mt-1"></i>
      <div>
        <h6 class="font-semibold text-yellow-900 dark:text-yellow-100">Gobierno de Configuraciones</h6>
        <p class="text-yellow-700 dark:text-yellow-200 text-sm mt-1">
          üî¥ <strong>Cr√≠ticas</strong>: Afectan c√°lculos financieros (requieren confirmaci√≥n)
          üü° <strong>Sensibles</strong>: Afectan operaciones
          üü¢ <strong>Cosm√©ticas</strong>: Solo apariencia
        </p>
      </div>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-2">
    <!-- INFORMACI√ìN GENERAL -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-gray-100">
        <i class="pi pi-building text-blue-600 dark:text-blue-400"></i>
        Informaci√≥n General
      </h3>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Nombre de la Peluquer√≠a</label>
          <input type="text" pInputText [(ngModel)]="settings().name"
                 class="w-full" placeholder="Mi Peluquer√≠a">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Logo</label>
          <p-fileUpload mode="basic" name="logo" accept="image/*"
                        [maxFileSize]="1000000" (onUpload)="onLogoUpload($event)"
                        chooseLabel="Seleccionar Logo" class="w-full">
          </p-fileUpload>
          <div *ngIf="settings().logo" class="mt-2">
            <img [src]="settings().logo" alt="Logo" class="h-16 w-auto rounded">
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-exclamation-triangle text-red-600"></i>
            Moneda
          </label>
          <p-select [(ngModel)]="settings().currency" [options]="currencies"
                    optionLabel="label" optionValue="value" class="w-full"
                    (onChange)="onCurrencyChange($event.value)">
          </p-select>
          <small class="text-red-600 dark:text-red-400">ADVERTENCIA: No se puede cambiar si existen transacciones</small>
        </div>
      </div>
    </div>

    <!-- CONFIGURACI√ìN DE PAGOS - ZONA ROJA -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors border-l-4 border-red-500">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-gray-100">
        <i class="pi pi-exclamation-triangle text-red-600 dark:text-red-400"></i>
        üî¥ Configuraci√≥n de Pagos (CR√çTICA)
      </h3>
      <div class="bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg p-3 mb-4">
        <p class="text-red-800 dark:text-red-200 text-sm">
          <i class="pi pi-exclamation-triangle mr-2"></i>
          <strong>ADVERTENCIA:</strong> Estos cambios afectan c√°lculos financieros en POS, Pagos y Reportes.
        </p>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-exclamation-triangle text-red-600"></i>
            Comisi√≥n por Defecto (%)
          </label>
          <input type="number" pInputText [(ngModel)]="settings().default_commission_rate"
                 class="w-full" placeholder="40" min="0" max="100">
          <small class="text-gray-500 dark:text-gray-400">Porcentaje que se aplicar√° a nuevos empleados por comisi√≥n</small>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-exclamation-triangle text-red-600"></i>
            Sueldo Fijo por Defecto ({{settings().currency_symbol}})
          </label>
          <input type="number" pInputText [(ngModel)]="settings().default_fixed_salary"
                 class="w-full" placeholder="1200000" min="0">
          <small class="text-gray-500 dark:text-gray-400">Sueldo que se aplicar√° a nuevos empleados con pago fijo</small>
        </div>
      </div>
    </div>

    <!-- HORARIOS DE ATENCI√ìN -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-gray-100">
        <i class="pi pi-clock text-purple-600 dark:text-purple-400"></i>
        Horarios de Atenci√≥n
      </h3>

      <div class="space-y-3">
        <div *ngFor="let day of days" class="flex items-center gap-3">
          <div class="w-20 text-sm font-medium text-gray-700 dark:text-gray-300">{{ day.label }}</div>

          <div class="flex items-center gap-2">
            <input type="checkbox"
                   [checked]="!getBusinessHour(day.key, 'closed')"
                   (change)="updateBusinessHour(day.key, 'closed', !$any($event.target).checked)"
                   class="rounded">
            <span class="text-sm text-gray-700 dark:text-gray-300">Abierto</span>
          </div>

          <div *ngIf="!getBusinessHour(day.key, 'closed')"
               class="flex items-center gap-2">
            <input type="time"
                   [ngModel]="getBusinessHour(day.key, 'open')"
                   (ngModelChange)="updateBusinessHour(day.key, 'open', $event)"
                   class="px-2 py-1 border rounded text-sm">
            <span class="text-sm text-gray-700 dark:text-gray-300">a</span>
            <input type="time"
                   [ngModel]="getBusinessHour(day.key, 'close')"
                   (ngModelChange)="updateBusinessHour(day.key, 'close', $event)"
                   class="px-2 py-1 border rounded text-sm">
          </div>

          <div *ngIf="getBusinessHour(day.key, 'closed')"
               class="text-sm text-gray-500 dark:text-gray-400">
            Cerrado
          </div>
        </div>
      </div>
    </div>

    <!-- POL√çTICAS Y REGLAS - ZONA AMARILLA -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors border-l-4 border-orange-500">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-gray-100">
        <i class="pi pi-info-circle text-orange-600 dark:text-orange-400"></i>
        üü° Pol√≠ticas y Reglas (SENSIBLE)
      </h3>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-exclamation-triangle text-red-600"></i>
            Impuesto (%)
          </label>
          <input type="number" pInputText [(ngModel)]="settings().tax_rate"
                 class="w-full" placeholder="19" min="0" max="100" step="0.01">
          <small class="text-red-600 dark:text-red-400">CR√çTICO: Afecta c√°lculos de impuestos en POS</small>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-info-circle text-orange-600"></i>
            Descuento M√°ximo (%)
          </label>
          <input type="number" pInputText [(ngModel)]="settings().service_discount_limit"
                 class="w-full" placeholder="20" min="0" max="100">
          <small class="text-gray-500 dark:text-gray-400">Descuento m√°ximo permitido en servicios</small>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-info-circle text-orange-600"></i>
            Cancelaci√≥n Gratuita (horas)
          </label>
          <input type="number" pInputText [(ngModel)]="settings().cancellation_policy_hours"
                 class="w-full" placeholder="24" min="1">
          <small class="text-gray-500 dark:text-gray-400">Horas antes de la cita para cancelar sin costo</small>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-cog text-gray-600"></i>
            Tolerancia Llegada Tarde (minutos)
          </label>
          <input type="number" pInputText [(ngModel)]="settings().late_arrival_grace_minutes"
                 class="w-full" placeholder="15" min="0">
          <small class="text-gray-500 dark:text-gray-400">Minutos de gracia para llegadas tard√≠as</small>
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300 flex items-center gap-2">
            <i class="pi pi-info-circle text-orange-600"></i>
            Reserva Anticipada (d√≠as)
          </label>
          <input type="number" pInputText [(ngModel)]="settings().booking_advance_days"
                 class="w-full" placeholder="30" min="1">
          <small class="text-gray-500 dark:text-gray-400">D√≠as m√°ximos para reservar con anticipaci√≥n</small>
        </div>
      </div>
    </div>

    <!-- INFORMACI√ìN DE CONTACTO -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-gray-100">
        <i class="pi pi-phone text-orange-600 dark:text-orange-400"></i>
        Informaci√≥n de Contacto
      </h3>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Tel√©fono</label>
          <input type="tel" pInputText [(ngModel)]="settings().contact.phone"
                 class="w-full" placeholder="+57 300 123 4567">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Email</label>
          <input type="email" pInputText [(ngModel)]="settings().contact.email"
                 class="w-full" placeholder="contacto@mipeluqueria.com">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Direcci√≥n</label>
          <textarea pInputText [(ngModel)]="settings().contact.address"
                    class="w-full h-20 resize-none"
                    placeholder="Calle 123 #45-67, Barrio Centro, Ciudad"></textarea>
        </div>
      </div>
    </div>

    <!-- CONFIGURACI√ìN POS -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 transition-colors border-l-4 border-emerald-500">
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-gray-100">
        <i class="pi pi-shopping-cart text-emerald-600 dark:text-emerald-400"></i>
        Configuraci√≥n POS (Tickets)
      </h3>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Esta informaci√≥n aparecer√° en los tickets de venta</p>

      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Nombre del Negocio</label>
          <input type="text" pInputText [(ngModel)]="settings().pos_config!.business_name"
                 class="w-full" placeholder="Mi Barber√≠a Premium">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Direcci√≥n</label>
          <input type="text" pInputText [(ngModel)]="settings().pos_config!.address"
                 class="w-full" placeholder="Calle Principal #123">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Tel√©fono</label>
          <input type="tel" pInputText [(ngModel)]="settings().pos_config!.phone"
                 class="w-full" placeholder="809-555-1234">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Email</label>
          <input type="email" pInputText [(ngModel)]="settings().pos_config!.email"
                 class="w-full" placeholder="contacto@mibarberia.com">
        </div>

        <div>
          <label class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300">Sitio Web</label>
          <input type="url" pInputText [(ngModel)]="settings().pos_config!.website"
                 class="w-full" placeholder="www.mibarberia.com">
        </div>
      </div>
    </div>
  </div>

  <!-- BOTONES DE ACCI√ìN -->
  <div class="flex justify-end gap-3 mt-6">
    <button pButton label="Cargar Configuraci√≥n" icon="pi pi-refresh"
            class="p-button-outlined" (click)="loadSettings()" [loading]="loading()">
    </button>
    <button pButton label="Guardar Cambios" icon="pi pi-save"
            class="p-button-success" (click)="saveSettings()" [loading]="loading()">
    </button>
  </div>

  <p-toast></p-toast>
  
  <!-- DI√ÅLOGO DE CONFIRMACI√ìN CR√çTICA -->
  <p-dialog header="‚ö†Ô∏è Confirmaci√≥n de Cambios Cr√≠ticos" 
            [visible]="showCriticalDialog()" 
            [modal]="true" 
            [closable]="false"
            [style]="{width: '600px'}">
    
    <div class="space-y-4">
      <div class="bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <i class="pi pi-exclamation-triangle text-red-600 text-xl mt-1"></i>
          <div>
            <h4 class="font-semibold text-red-900 dark:text-red-100 mb-2">ADVERTENCIA: Cambios Cr√≠ticos Detectados</h4>
            <p class="text-red-800 dark:text-red-200 text-sm">
              Los siguientes cambios afectan c√°lculos financieros y pueden impactar POS, Pagos y Reportes.
              <strong>Confirme que comprende las consecuencias antes de continuar.</strong>
            </p>
          </div>
        </div>
      </div>

      <div class="space-y-3">
        <div *ngFor="let change of criticalChanges()" 
             class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="font-medium text-gray-900 dark:text-gray-100">{{ change.setting }}</div>
              <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">{{ change.impact }}</div>
              <div class="text-xs text-gray-500 dark:text-gray-500 mt-2">
                <span class="font-medium">Anterior:</span> {{ change.old_value || 'No definido' }} ‚Üí 
                <span class="font-medium">Nuevo:</span> {{ change.new_value }}
              </div>
            </div>
            <div class="ml-3">
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                    [ngClass]="{
                      'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300': change.type === 'critical',
                      'bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300': change.type === 'sensitive'
                    }">
                {{ change.type === 'critical' ? 'CR√çTICO' : 'SENSIBLE' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-800 rounded-lg p-3">
        <p class="text-yellow-800 dark:text-yellow-200 text-sm">
          <i class="pi pi-info-circle mr-2"></i>
          <strong>Nota:</strong> Estos cambios ser√°n registrados en el log de auditor√≠a para trazabilidad.
        </p>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-3">
        <button pButton label="Cancelar" 
                class="p-button-outlined p-button-secondary" 
                (click)="cancelCriticalChanges()">
        </button>
        <button pButton label="Confirmar y Guardar" 
                class="p-button-danger" 
                (click)="confirmCriticalChanges()"
                [loading]="loading()">
        </button>
      </div>
    </ng-template>
  </p-dialog>
</div>
